## 실행컨텍스트 생성, 식별자 검색 과정

![excution-process](https://user-images.githubusercontent.com/33679192/67630513-4370e600-f8cc-11e9-8f27-e4586c4e37a1.png)

1. **전역 객체 생성**  
   window객체, Web Api객체(Dom, Bom, Canvas)등 추가되며, 전역 객체도 **Object.prototype을 상속** 받는다.
2. **전역 코드 평가**  
   전역 실행 컨텍스트 생성  
   전역 렉시컬 환경 생성
3. **전역코드 실행**   
   코드가 실행되면서 변수에 값이 할당. 함수 호출. 실행될때 실행컨텍스트의 렉시컬 환경에서 식별자를 검색한다. 식별자를 검색할 수 없으면 외부 렉시컬 환경에 대한 참조가 가리키는 렉시컬 환경으로 이동하여 식별자를 검색한다. 전역 렉시컬 환경은 스코프 체인의 종점이므로 전역 렉시컬 환경에서 검색할 수 없는 식별자는 참조 에러를 발생시킨다.
4. **지역함수코드 평가**  
   함수 실행 컨텍스트 생성  
   함수 렉시컬 환경 생성  : 환경레코드: 식별자 등록 및 관리, 외부환경참조 : 렉시컬 스코프 체인, this바인딩
5. **지역함수코드 실행 및 종료** 
   실행 컨텍스트에서 함수 실행이 종료되었어도 렉시컬 환경까지 소멸하는것은 아니다. 누군가에 의해 참조되지 않을때 가비지 컬렉터에 의해 소멸된다.  
   종료될때 실행컨텍스트 스택에서 팝되어 제거된다.  그리고 전역 실행 컨텍스트가 실행중인 컨텍스트가 된다.

### 실행 컨텍스트와 블록 레벨 스코프

let, const로 선언한 변수는 (함수,if문,for문,while문) 등 지역 스코프로 인정하는 블록 레벨 스코프를 따른다.

![block-level1](https://user-images.githubusercontent.com/33679192/67630940-761ddd00-f8d2-11e9-9c36-c38ad651224b.png)

block레벨의 문 실행이 종료되면 문이 실행되기 이전의 렉시컬 환경으로 되돌린다.

![block-level2](https://user-images.githubusercontent.com/33679192/67630949-92ba1500-f8d2-11e9-92f6-dff77c5f5456.png)

<br>

### 정리

> 1. 코드 평가가 이뤄지기 전에 전역객체가 생성된다.
> 2. 코드를 평가하면서 실행 컨텍스트가 생성되고 렉시컬 환경이 조성된다.
>    **실행컨텍스트는**  
>    코드를 평가하고, 실행하기 위한 환경을 제공하고, 코드 실행 결과를 관리하는 영역이고,  
>    **렉시컬 환경은**  
>    식별자를 등록 및 관리, 단방향 리스트인 상위 렉시컬 환경에 스코프 체인 구현, this바인딩.
>    추가로 함수객체가 생성될때 렉시컬 환경을 내부슬롯 [[Environment]]에 저장한다.
>
> 3. 이 전역 실행컨텍스트는 실행 컨텍스트 스택에 쌓이며(push)되며 실행된다. 
> 4. 함수가 호출이되면 전역 실행을 멈추고 함수 내부로 진입해서 실행컨텍스트, 렉시컬 환경이 조성되며 실행 컨텍스트 스택에 push된다.
> 5. 종료되면 pop되어 실행컨텍스트 스택에서 제거된다
>    이때 렉시컬 환경은 실행컨텍스트가 제거되도 내부 함수에 의해 참조되면 가비지 컬렉터의 대상이 되지 않고 제거 되지 않는다.
> 6. 블록 레벨 스코프는 실행 컨텍스트가 다시생성되는것이아니라 렉시컬 환경만 추가적으로 추가된다